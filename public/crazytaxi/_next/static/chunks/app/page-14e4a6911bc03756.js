(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{127:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var o=n(5155),a=n(2115),i=n(8661),r=n.n(i),s=n(7909),c=n(8946),l=n(8774);function d(e){let{taxisRef:t,onGameOver:n,isPaused:i,onTogglePause:s}=e,[l,d]=(0,a.useState)(0),[f,u]=(0,a.useState)(1),[p,h]=(0,a.useState)(300),[g,b]=(0,a.useState)(120),[x,m]=(0,a.useState)(0),[w,j]=(0,a.useState)(Date.now());(0,a.useEffect)(()=>{let e=setInterval(()=>{let e=t.current.reduce((e,t)=>e+t.money,0);if(d(e),u(t.current.length),i)j(Date.now());else{let t=Date.now(),o=(t-w)/1e3;j(t);let a=x+o;m(a);let i=Math.max(0,120-a);b(i),i<=0&&n(e)}},100);return()=>clearInterval(e)},[t,n,i,x,w]);let v=l>=p,y=Math.floor(g);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"jsx-194bad75a3c67f54 top-bar",children:[(0,o.jsxs)("div",{className:"jsx-194bad75a3c67f54 taxi-info",children:["Taxis: ",f]}),(0,o.jsxs)("button",{onClick:()=>{if(l<p)return void console.log("❌ Not enough money! Need $".concat(p,", have $").concat(l));let e=(0,c.nt)();if(0===e.paths.length)return void console.warn("⚠️ No paths available to spawn taxi");let n=e.paths.filter(e=>e.id.includes("Intersection")),o=n.length>0?n[Math.floor(Math.random()*n.length)]:e.paths[0],a={id:"taxi-".concat(t.current.length+1),state:"driving_to_pickup",path:o,t:0,speed:1.5,isFocused:!1,currentIntersectionId:void 0,incomingDir:0,previousNodeId:void 0,hasPackage:!1,currentDeliveryId:void 0,money:-p,isReversing:!1,collisionCooldown:0};t.current.push(a),console.log("\uD83D\uDE95 Spawned ".concat(a.id," on path ").concat(o.id," for $").concat(p)),h(p+100)},disabled:!v,className:"jsx-194bad75a3c67f54 spawn-button",children:["+ Spawn Taxi ($",p,")"]})]}),(0,o.jsx)("div",{className:"jsx-194bad75a3c67f54 pause-container",children:(0,o.jsx)("button",{onClick:s,className:"jsx-194bad75a3c67f54 pause-button",children:i?"▶":"❚❚"})}),(0,o.jsx)("div",{className:"jsx-194bad75a3c67f54 timer-display",children:y}),(0,o.jsxs)("div",{className:"jsx-194bad75a3c67f54 money-display",children:["$",l]}),(0,o.jsx)(r(),{id:"194bad75a3c67f54",children:".top-bar.jsx-194bad75a3c67f54{position:fixed;top:20px;left:20px;display:flex;gap:16px;align-items:center;pointer-events:auto;z-index:100}.taxi-info.jsx-194bad75a3c67f54{font-size:24px;font-weight:bold;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.8);font-family:monospace;background:rgba(0,0,0,.5);padding:8px 16px;border-radius:4px}.spawn-button.jsx-194bad75a3c67f54{font-size:18px;font-weight:bold;padding:8px 16px;background:#0f0;color:#000;border:none;border-radius:4px;cursor:pointer;font-family:monospace;transition:all.2s}.spawn-button.jsx-194bad75a3c67f54:hover{background:#0d0;transform:scale(1.05)}.spawn-button.jsx-194bad75a3c67f54:active{transform:scale(.95)}.spawn-button.jsx-194bad75a3c67f54:disabled{background:#666;color:#999;cursor:not-allowed;transform:none}.spawn-button.jsx-194bad75a3c67f54:disabled:hover{background:#666;transform:none}.pause-container.jsx-194bad75a3c67f54{position:fixed;top:20px;right:20px;pointer-events:auto;z-index:100}.pause-button.jsx-194bad75a3c67f54{font-size:28px;font-weight:bold;padding:12px 20px;background:rgba(255,255,255,.9);color:#000;border:2px solid#000;border-radius:8px;cursor:pointer;font-family:monospace;transition:all.2s;min-width:70px}.pause-button.jsx-194bad75a3c67f54:hover{background:#fff;transform:scale(1.05)}.pause-button.jsx-194bad75a3c67f54:active{transform:scale(.95)}.timer-display.jsx-194bad75a3c67f54{position:fixed;bottom:20px;left:20px;font-size:32px;font-weight:bold;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.8);font-family:monospace;pointer-events:none;z-index:100;padding:8px 16px;border-radius:4px;min-width:80px;text-align:center}.money-display.jsx-194bad75a3c67f54{position:fixed;bottom:20px;right:20px;font-size:32px;font-weight:bold;color:#ff0;text-shadow:2px 2px 4px rgba(0,0,0,.8);font-family:monospace;pointer-events:none;z-index:100}"})]})}function f(e){let{score:t,onRestart:n}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"jsx-2b318a3b15909e7c modal-overlay",children:(0,o.jsxs)("div",{className:"jsx-2b318a3b15909e7c modal-content",children:[(0,o.jsx)("h1",{className:"jsx-2b318a3b15909e7c title",children:"Game Over!"}),(0,o.jsxs)("div",{className:"jsx-2b318a3b15909e7c score-section",children:[(0,o.jsx)("div",{className:"jsx-2b318a3b15909e7c score-label",children:"Final Score"}),(0,o.jsxs)("div",{className:"jsx-2b318a3b15909e7c score-value",children:["$",t]})]}),(0,o.jsx)("button",{onClick:n,className:"jsx-2b318a3b15909e7c restart-button",children:"Play Again"})]})}),(0,o.jsx)(r(),{id:"2b318a3b15909e7c",children:".modal-overlay.jsx-2b318a3b15909e7c{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;pointer-events:auto}.modal-content.jsx-2b318a3b15909e7c{background:#1a1a1a;border:4px solid#0f0;border-radius:8px;padding:48px 64px;display:flex;flex-direction:column;align-items:center;gap:32px;box-shadow:0 0 40px rgba(0,255,0,.3)}.title.jsx-2b318a3b15909e7c{font-size:48px;font-weight:bold;color:#0f0;margin:0;font-family:monospace;text-shadow:0 0 10px rgba(0,255,0,.5)}.score-section.jsx-2b318a3b15909e7c{display:flex;flex-direction:column;align-items:center;gap:8px}.score-label.jsx-2b318a3b15909e7c{font-size:24px;color:#fff;font-family:monospace}.score-value.jsx-2b318a3b15909e7c{font-size:64px;font-weight:bold;color:#ff0;font-family:monospace;text-shadow:0 0 10px rgba(255,255,0,.5)}.restart-button.jsx-2b318a3b15909e7c{font-size:24px;font-weight:bold;padding:16px 48px;background:#0f0;color:#000;border:none;border-radius:4px;cursor:pointer;font-family:monospace;transition:all.2s}.restart-button.jsx-2b318a3b15909e7c:hover{background:#0d0;transform:scale(1.05)}.restart-button.jsx-2b318a3b15909e7c:active{transform:scale(.95)}"})]})}let u=(0,s.default)(()=>Promise.all([n.e(367),n.e(413),n.e(828),n.e(108)]).then(n.bind(n,2108)),{loadableGenerated:{webpack:()=>[2108]},ssr:!1,loading:()=>(0,o.jsx)("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#000",color:"#fff"},children:"Loading game..."})});function p(){let[e,t]=(0,a.useState)(!1),[n,i]=(0,a.useState)(0),[s,p]=(0,a.useState)(0),[h,g]=(0,a.useState)(!1),{taxisRef:b,deliveriesRef:x,pickupNodesRef:m,deliveryTimerRef:w,initialSpawnDoneRef:j}=function(){let e=(0,a.useRef)([{id:"taxi-1",state:"driving_to_pickup",path:(0,c.nt)().paths[0]||null,t:0,speed:1.5,isFocused:!1,currentIntersectionId:void 0,incomingDir:0,previousNodeId:void 0,hasPackage:!1,currentDeliveryId:void 0,money:0,isReversing:!1,collisionCooldown:0}]),t=(0,a.useRef)([]),n=(0,a.useRef)(1e4),o=(0,a.useRef)([]),i=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{let n=n=>{let{network:a}=n.detail;if(console.log("\uD83D\uDE95 Taxi received road network update:",a),a.paths.length>0&&e.current[0]){let t=a.paths.filter(e=>e.id.includes("Intersection")),n=t.length>0?t[0]:a.paths[0];e.current[0].path=n,e.current[0].t=0,console.log("✅ Taxi updated to starting path: ".concat(n.id)),console.log("   Available paths: ".concat(a.paths.length)),console.log("   Intersection paths: ".concat(t.length))}if(a.nodes){let e=a.nodes.filter(e=>e.types.includes("pickup"));if(o.current=e,console.log("\uD83D\uDCCD Found ".concat(e.length," pickup nodes")),e.length>=2&&!i.current){for(let n=0;n<3;n++){let n=(0,l.aK)(e,t.current);n&&t.current.push(n)}i.current=!0,console.log("\uD83C\uDFAE Spawned 3 initial deliveries")}}};return window.addEventListener("roadNetworkUpdated",n),()=>{window.removeEventListener("roadNetworkUpdated",n)}},[]),{taxisRef:e,deliveriesRef:t,pickupNodesRef:o,deliveryTimerRef:n,initialSpawnDoneRef:i}}();return(0,o.jsxs)("div",{className:"jsx-70b4a1d027e0d3f2 game-container",children:[(0,o.jsx)(u,{taxisRef:b,deliveriesRef:x,pickupNodesRef:m,deliveryTimerRef:w,isPaused:h}),(0,o.jsx)("div",{className:"jsx-70b4a1d027e0d3f2 ui-overlay",children:(0,o.jsx)(d,{taxisRef:b,onGameOver:n=>{e||(i(n),t(!0))},isPaused:h,onTogglePause:()=>g(!h)})}),e&&(0,o.jsx)(f,{score:n,onRestart:()=>{b.current=[{id:"taxi-1",state:"driving_to_pickup",path:(0,c.nt)().paths[0]||null,t:0,speed:1.5,isFocused:!1,currentIntersectionId:void 0,incomingDir:0,previousNodeId:void 0,hasPackage:!1,currentDeliveryId:void 0,money:0,isReversing:!1,collisionCooldown:0}],x.current=[],w.current=1e4,j.current=!1,t(!1),i(0),p(e=>e+1)}}),(0,o.jsx)(r(),{id:"70b4a1d027e0d3f2",children:".game-container.jsx-70b4a1d027e0d3f2{position:relative;width:100vw;height:100vh;overflow:hidden}.ui-overlay.jsx-70b4a1d027e0d3f2{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;padding:2rem}"})]},s)}var h=n(5239);let g=[{image:"/tutorial_01.png",text:"Click intersections to control taxi routing. Green + for straight, blue ↶ for left, orange ↷ for right."},{image:"/tutorial_02.png",text:"Taxis automatically pick up colored packages and deliver them to matching colored destinations."},{image:"/tutorial_03.png",text:"Earn money from deliveries. Spawn additional taxis for $300 (+$100 each). You have 120 seconds!"}];function b(){let[e,t]=(0,a.useState)(0);return(0,o.jsxs)("div",{className:"jsx-bba184fbb12701da tutorial-slider",children:[(0,o.jsxs)("div",{className:"jsx-bba184fbb12701da slider-content",children:[(0,o.jsx)("button",{onClick:()=>{t(e=>(e-1+g.length)%g.length)},className:"jsx-bba184fbb12701da arrow arrow-left",children:"‹"}),(0,o.jsxs)("div",{className:"jsx-bba184fbb12701da slide",children:[(0,o.jsx)("div",{className:"jsx-bba184fbb12701da slide-image",children:(0,o.jsx)(h.default,{src:g[e].image,alt:"Tutorial step ".concat(e+1),width:600,height:400,style:{objectFit:"contain"},priority:!0})}),(0,o.jsx)("p",{className:"jsx-bba184fbb12701da slide-text",children:g[e].text})]}),(0,o.jsx)("button",{onClick:()=>{t(e=>(e+1)%g.length)},className:"jsx-bba184fbb12701da arrow arrow-right",children:"›"})]}),(0,o.jsx)("div",{className:"jsx-bba184fbb12701da dots",children:g.map((n,a)=>(0,o.jsx)("button",{onClick:()=>{t(a)},"aria-label":"Go to slide ".concat(a+1),className:"jsx-bba184fbb12701da "+"dot ".concat(a===e?"active":"")},a))}),(0,o.jsx)(r(),{id:"bba184fbb12701da",children:".tutorial-slider.jsx-bba184fbb12701da{width:100%;max-width:700px;margin:2rem auto}.slider-content.jsx-bba184fbb12701da{display:flex;align-items:center;gap:1rem;position:relative}.arrow.jsx-bba184fbb12701da{background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.5);color:white;font-size:3rem;width:50px;height:50px;border-radius:50%;cursor:pointer;transition:all.2s;display:flex;align-items:center;justify-content:center;padding:0;flex-shrink:0}.arrow.jsx-bba184fbb12701da:hover{background:rgba(255,255,255,.4);transform:scale(1.1)}.arrow.jsx-bba184fbb12701da:active{transform:scale(.95)}.slide.jsx-bba184fbb12701da{flex:1;text-align:center}.slide-image.jsx-bba184fbb12701da{background:rgba(0,0,0,.3);border-radius:8px;padding:1rem;margin-bottom:1rem;min-height:400px;display:flex;align-items:center;justify-content:center}.slide-text.jsx-bba184fbb12701da{color:white;font-size:1.1rem;line-height:1.6;margin:0;padding:0 2rem;text-shadow:2px 2px 4px rgba(0,0,0,.5)}.dots.jsx-bba184fbb12701da{display:flex;justify-content:center;gap:.75rem;margin-top:1.5rem}.dot.jsx-bba184fbb12701da{width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,.3);border:2px solid rgba(255,255,255,.5);cursor:pointer;transition:all.3s;padding:0}.dot.jsx-bba184fbb12701da:hover{background:rgba(255,255,255,.5);transform:scale(1.2)}.dot.active.jsx-bba184fbb12701da{background:#ff0;border-color:#ff6b00;transform:scale(1.3)}@media(max-width:768px){.arrow.jsx-bba184fbb12701da{font-size:2rem;width:40px;height:40px}.slide-image.jsx-bba184fbb12701da{min-height:300px}.slide-text.jsx-bba184fbb12701da{font-size:.95rem;padding:0 1rem}}"})]})}function x(e){let{onPlay:t}=e;return(0,o.jsxs)("div",{className:"jsx-73d25fb72628ac7 intro-scene",children:[(0,o.jsxs)("div",{className:"jsx-73d25fb72628ac7 intro-content",children:[(0,o.jsx)("h1",{className:"jsx-73d25fb72628ac7 game-title",children:"Wayne Mo"}),(0,o.jsx)("p",{className:"jsx-73d25fb72628ac7 game-subtitle",children:"AI MANAGEMENT AUTOMATION"}),(0,o.jsx)("button",{onClick:t,className:"jsx-73d25fb72628ac7 play-button",children:"PLAY"}),(0,o.jsx)("div",{className:"jsx-73d25fb72628ac7 intro-hints",children:(0,o.jsx)("p",{className:"jsx-73d25fb72628ac7",children:"Command your autonomous taxi fleet"})})]}),(0,o.jsxs)("div",{className:"jsx-73d25fb72628ac7 tutorial-section",children:[(0,o.jsx)("h2",{className:"jsx-73d25fb72628ac7 tutorial-title",children:"How to Play"}),(0,o.jsx)(b,{})]}),(0,o.jsx)(r(),{id:"73d25fb72628ac7",children:".intro-scene.jsx-73d25fb72628ac7{position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;z-index:1000;overflow-y:auto;padding:2rem 1rem}.intro-content.jsx-73d25fb72628ac7{text-align:center;color:white;animation:fadeIn 1s ease-in;margin-bottom:2rem}.tutorial-section.jsx-73d25fb72628ac7{width:100%;max-width:800px;margin-top:2rem;animation:fadeIn 1.5s ease-in}.tutorial-title.jsx-73d25fb72628ac7{color:#ff0;font-size:2rem;font-weight:900;text-align:center;margin-bottom:1rem;text-shadow:2px 2px 4px rgba(0,0,0,.3);-webkit-text-stroke:1px#ff6b00}.game-title.jsx-73d25fb72628ac7{font-size:4rem;font-weight:900;letter-spacing:.2em;margin:0;text-shadow:4px 4px 8px rgba(0,0,0,.3);color:#ff0;-webkit-text-stroke:2px#ff6b00}.game-subtitle.jsx-73d25fb72628ac7{font-size:1.2rem;letter-spacing:.3em;margin:1rem 0 3rem;opacity:.9}.play-button.jsx-73d25fb72628ac7{background:#ff0;color:#000;border:4px solid#ff6b00;padding:1.5rem 4rem;font-size:2rem;font-weight:900;letter-spacing:.2em;cursor:pointer;transition:all.3s ease;box-shadow:0 8px 16px rgba(0,0,0,.3);border-radius:8px}.play-button.jsx-73d25fb72628ac7:hover{transform:translatey(-4px)scale(1.05);box-shadow:0 12px 24px rgba(0,0,0,.4);background:#fff200}.play-button.jsx-73d25fb72628ac7:active{transform:translatey(-2px)scale(1.02)}.intro-hints.jsx-73d25fb72628ac7{margin-top:3rem;opacity:.7}.intro-hints.jsx-73d25fb72628ac7 p.jsx-73d25fb72628ac7{margin:.5rem 0;font-size:1rem}@keyframes fadeIn{from{opacity:0;transform:translatey(20px)}to{opacity:1;transform:translatey(0)}}@media(max-width:768px){.intro-scene.jsx-73d25fb72628ac7{padding:1rem .5rem}.game-title.jsx-73d25fb72628ac7{font-size:2.5rem}.play-button.jsx-73d25fb72628ac7{padding:1rem 2.5rem;font-size:1.5rem}.tutorial-title.jsx-73d25fb72628ac7{font-size:1.5rem}}"})]})}function m(){let[e,t]=(0,a.useState)(!1);return e?(0,o.jsx)(p,{}):(0,o.jsx)(x,{onPlay:()=>t(!0)})}},4510:(e,t,n)=>{"use strict";n.d(t,{E$:()=>i,KQ:()=>r,ac:()=>s});var o=n(5339),a=n(8946);function i(e,t,n){if("stopped"===e.state||!e.path)return;let o=t*e.speed/e.path.length;e.isReversing?(e.t-=o,e.t<=0&&(e.t=0,e.isReversing=!1,console.log("✅ ".concat(e.id," finished reversing, back at start of path")),function(e,t){if(!e.path)return;let n=e.path.id,o=n.split("_to_");if(2!==o.length)return console.warn("⚠️ Invalid path ID format: ".concat(n));let i=o[0],r=o[1],s="".concat(r,"_to_").concat(i);console.log("\uD83D\uDD04 ".concat(e.id," at ").concat(i,", routing from here (was reversing on ").concat(n,")"));let c=(0,a.D3)(s,t,e);c?(console.log("\uD83D\uDE95 Post-reversal transition: ".concat(i," → ").concat(c.id)),e.path=c,e.t=0):console.warn("⚠️ No next path found from ".concat(i," after reversal"))}(e,n))):(e.t+=o,e.t>=1&&(e.t=1,function(e,t){if(!e.path)return;let n=e.path.id,o=n.split("_to_");2===o.length&&(e.previousNodeId=o[0]);let i=(0,a.D3)(n,t,e);i?(console.log("\uD83D\uDE95 Path transition: ".concat(n," → ").concat(i.id)),e.path=i,e.t=0):console.warn("⚠️ No next path found for ".concat(n))}(e,n)))}function r(e,t){if(0===e.points.length)return new o.Pq0;if(1===e.points.length)return e.points[0].clone();let n=Math.max(0,Math.min(1,t)),a=Math.floor(n*(e.points.length-1)),i=Math.min(a+1,e.points.length-1),r=n*(e.points.length-1)%1;return e.points[a].clone().lerp(e.points[i],r)}function s(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].distanceTo(e[n+1]);return t}},8164:(e,t,n)=>{Promise.resolve().then(n.bind(n,127))},8774:(e,t,n)=>{"use strict";n.d(t,{WF:()=>s,aK:()=>i});var o=n(5339);let a=["#00ff00","#0088ff","#ff00ff","#ffff00","#ff8800","#00ffff","#ff0088","#88ff00","#ff0000","#8800ff","#00ff88","#ff8888","#88ff88","#8888ff","#ffff88","#ff88ff"];function i(e){var t,n;let o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e.length<2)return console.warn("⚠️ Not enough pickup nodes to spawn delivery"),null;let r=e[Math.floor(Math.random()*e.length)];do o=e[Math.floor(Math.random()*e.length)];while(o.id===r.id);let s=r.position.distanceTo(o.position),c=Math.floor((((null==(t=r.metadata)?void 0:t.payoutMultiplier)||1)+((null==(n=o.metadata)?void 0:n.payoutMultiplier)||1))/2*(100+10*s)),l=new Set(i.map(e=>e.color)),d=a.filter(e=>!l.has(e)),f=d.length>0?d:a,u=f[Math.floor(Math.random()*f.length)],p={id:"delivery-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),pickupNodeId:r.id,dropoffNodeId:o.id,status:"waiting_pickup",spawnTime:Date.now(),payout:c,color:u};return console.log("\uD83D\uDCE6 Spawned delivery: ".concat(r.id," → ").concat(o.id," ($").concat(c,") [").concat(u,"]")),p}function r(e,t,n){for(let o of t.filter(e=>"waiting_pickup"===e.status)){let t=n.find(e=>e.id===o.pickupNodeId);if(t&&2>e.distanceTo(t.position))return{event:o,node:t}}return null}function s(e,t,n){let a=[];for(let s of e){if(!s.path)continue;let e=s.path.points;if(e.length<2)continue;let c=1/(e.length-1),l=Math.floor(s.t/c),d=s.t%c/c,f=e[Math.min(l,e.length-2)],u=e[Math.min(l+1,e.length-1)],p=new o.Pq0().lerpVectors(f,u,d);if(s.hasPackage){let e=r(p,t,n);e&&.1>Math.random()&&console.log("\uD83D\uDEAB ".concat(s.id," ignoring pickup ").concat(e.event.id," (already carrying ").concat(s.currentDeliveryId,")"))}else{var i;let e=r(p,t,n);e&&(i=e.event,s.hasPackage=!0,s.currentDeliveryId=i.id,i.status="in_transit",i.claimedByTaxiId=s.id,i.pickupTime=Date.now(),console.log("\uD83D\uDE95 ".concat(s.id," picked up ").concat(i.id," at ").concat(i.pickupNodeId)))}if(s.currentDeliveryId){let e=function(e,t,n,o){let a=n.find(e=>e.id===t&&"in_transit"===e.status);if(!a)return null;let i=o.find(e=>e.id===a.dropoffNodeId);return i&&2>e.distanceTo(i.position)?{event:a,node:i}:null}(p,s.currentDeliveryId,t,n);e&&(!function(e,t){e.hasPackage=!1,e.currentDeliveryId=void 0,e.money+=t.payout,t.status="completed",t.deliveryTime=Date.now();let n=((t.deliveryTime-t.spawnTime)/1e3).toFixed(1);console.log("✅ ".concat(e.id," completed ").concat(t.id," at ").concat(t.dropoffNodeId," (+$").concat(t.payout,") in ").concat(n,"s")),t.payout}(s,e.event),a.push(e.event.id))}}return a}},8946:(e,t,n)=>{"use strict";n.d(t,{D3:()=>b,nt:()=>g,WW:()=>h});var o=n(5339),a=n(4510);function i(e){return["North","East","South","West"][e]}let r=[new o.Pq0(-15,.2,-15),new o.Pq0(-15,.2,-5),new o.Pq0(-15,.2,5),new o.Pq0(-15,.2,15)],s=[new o.Pq0(-15,.2,15),new o.Pq0(-5,.2,15),new o.Pq0(5,.2,15),new o.Pq0(15,.2,15)],c=[new o.Pq0(15,.2,15),new o.Pq0(15,.2,5),new o.Pq0(15,.2,-5),new o.Pq0(15,.2,-15)],l=[new o.Pq0(15,.2,-15),new o.Pq0(5,.2,-15),new o.Pq0(-5,.2,-15),new o.Pq0(-15,.2,-15)],d={id:"path-1",points:r,length:(0,a.ac)(r)},f={id:"path-2",points:s,length:(0,a.ac)(s)},u={id:"path-3",points:c,length:(0,a.ac)(c)},p={paths:[d,f,u,{id:"path-4",points:l,length:(0,a.ac)(l)}],nodes:[{id:"node-1",position:new o.Pq0(-15,.2,-15),neighbors:["node-2","node-4",null,null],types:["intersection"]},{id:"node-2",position:new o.Pq0(-15,.2,15),neighbors:[null,"node-3","node-1",null],types:["intersection","pickup"],metadata:{zoneName:"North Terminal",payoutMultiplier:1.2}},{id:"node-3",position:new o.Pq0(15,.2,15),neighbors:[null,null,"node-4","node-2"],types:["intersection","red_light"],metadata:{redLightDuration:3,greenLightDuration:5,currentState:"green"}},{id:"node-4",position:new o.Pq0(15,.2,-15),neighbors:["node-3",null,null,"node-1"],types:["intersection","dropoff"],metadata:{zoneName:"Downtown",payoutMultiplier:1}}]};function h(e){console.log("\uD83D\uDEE3️ Updating road network with ".concat(e.length," extracted nodes"));let t=[],n=new Set;return e.forEach(o=>{let i=[];o.neighbors?(i=o.neighbors.filter(e=>null!==e),console.log("  ".concat(o.id,": topological format, ").concat(i.length," neighbors"))):o.next&&(i=o.next,console.log("  ".concat(o.id,": legacy format, ").concat(i.length," next nodes"))),i.forEach(i=>{let r="".concat(o.id,"_to_").concat(i);if(n.has(r))return;let s=e.find(e=>e.id===i);if(!s)return void console.warn("⚠️ Node ".concat(i," referenced by ").concat(o.id," not found"));let c=[o.position.clone(),s.position.clone()];t.push({id:r,points:c,length:(0,a.ac)(c)}),n.add(r),console.log("  ✅ Created path: ".concat(r))})}),p={nodes:e,paths:t},console.log("✅ Road network updated: ".concat(e.length," nodes, ").concat(t.length," paths")),console.log("\uD83D\uDCCA Network Graph:"),e.forEach(e=>{e.neighbors?console.log("  ".concat(e.id," [TOPO] → N:").concat(e.neighbors[0]||"-",", E:").concat(e.neighbors[1]||"-",", S:").concat(e.neighbors[2]||"-",", W:").concat(e.neighbors[3]||"-")):e.next&&console.log("  ".concat(e.id," [LEGACY] → [").concat(e.next.join(", "),"]"))}),console.log("\uD83D\uDEE3️ Generated Paths:"),t.forEach(e=>{console.log("  ".concat(e.id," (").concat(e.length.toFixed(2)," units)"))}),p}function g(){return p}function b(e,t,n){let a=p.paths,r=p.nodes,s=e.split("_to_");if(2!==s.length)return console.warn("⚠️ Invalid path ID format: ".concat(e)),null;let c=s[0],l=s[1],d=r.find(e=>e.id===l);if(!d)return console.warn("⚠️ Destination node ".concat(l," not found")),null;if(d.neighbors&&n){var f;let e;for(let t=0;t<4;t++)if(d.neighbors[t]===c){e=t;break}void 0===e&&console.warn("⚠️ Could not calculate incomingDir for ".concat(c," → ").concat(l,", using fallback"));let o=null!=(f=null!=e?e:n.incomingDir)?f:0,r=d.types.includes("intersection")?null==t?void 0:t.get(l):void 0,s=(null==r?void 0:r.mode)||"pass_through",u=function(e,t,n){if(!e.neighbors||4!==e.neighbors.length)return console.warn("⚠️ Node ".concat(e.id," is not a valid intersection (no neighbors array)")),{nextId:null,outgoingDir:null};let o=e.neighbors.filter(e=>null!==e).length;if(1===o){let n=e.neighbors[t];if(n)return console.log("⚠️ ".concat(e.id,": Dead end, U-turn back → ").concat(n)),{nextId:n,outgoingDir:t}}if(2===o)for(let n=0;n<4;n++){let o=n;if(o!==t&&null!==e.neighbors[o]){let n=e.neighbors[o];return console.log("\uD83D\uDD04 ".concat(e.id,": Corner, Incoming ").concat(i(t)," → ").concat(i(o)," → ").concat(n)),{nextId:n,outgoingDir:o}}}for(let o of function(e,t){if(2===e)switch(t){case"pass_through":return[0,1,2,3];case"turn_right":return[1,2,3,0];case"turn_left":return[3,2,1,0]}else if(0===e)switch(t){case"pass_through":return[2,3,0,1];case"turn_right":return[3,0,1,2];case"turn_left":return[1,0,3,2]}else if(3===e)switch(t){case"pass_through":return[1,2,3,0];case"turn_right":return[2,3,0,1];case"turn_left":return[0,3,2,1]}else switch(t){case"pass_through":return[3,0,1,2];case"turn_right":return[0,1,2,3];case"turn_left":return[2,1,0,3]}}(t,n)){if(o===t)continue;let a=e.neighbors[o];if(null!==a)return console.log("✅ ".concat(e.id,": Incoming ").concat(i(t),", Mode ").concat(n,", Chose ").concat(i(o)," → ").concat(a)),{nextId:a,outgoingDir:o}}return console.warn("⚠️ ".concat(e.id,": No available path from ").concat(i(t)," with mode ").concat(n)),{nextId:null,outgoingDir:null}}(d,o,s);if(!u.nextId||null===u.outgoingDir)return console.warn("⚠️ No available route from ".concat(l)),null;{let e=a.find(e=>e.id==="".concat(l,"_to_").concat(u.nextId));if(!e)return console.warn("⚠️ Path ".concat(l,"_to_").concat(u.nextId," not found in network")),null;{let t=(u.outgoingDir+2)%4;return n.currentIntersectionId=l,n.incomingDir=t,console.log("\uD83D\uDEA6 ".concat(l,": Mode ").concat(s,", In ").concat(i(o)," → Out ").concat(i(u.outgoingDir)," → ").concat(u.nextId)),e}}}let u=a.filter(e=>e.id.startsWith("".concat(l,"_to_")));if(0===u.length)return console.warn("⚠️ No next path found from node: ".concat(l)),null;if(1===u.length)return u[0];if(d.types.includes("intersection")&&t){let n=t.get(l);if(n){let t=function(e,t,n){let a=n.filter(e=>e.id.startsWith("".concat(t.id,"_to_"))),i=n.find(t=>t.id===e);if(!i)return console.warn("⚠️ Incoming path ".concat(e," not found")),{straight:null,left:null,right:null};if(1===a.length)return{straight:a[0].id,left:null,right:null};let r={straight:null,left:null,right:null};return a.forEach(e=>{let n=function(e,t,n){let a=new o.Pq0().subVectors(e.points[e.points.length-1],e.points[e.points.length-2]).normalize(),i=new o.Pq0().subVectors(n.points[1],n.points[0]).normalize(),r=new o.Pq0().crossVectors(a,i);return a.dot(i)>.8?"straight":r.y>.1?"left":r.y<-.1?"right":"straight"}(i,0,e);r[n]?console.warn('⚠️ Multiple paths detected as "'.concat(n,'" at ').concat(t.id)):r[n]=e.id}),console.log("\uD83D\uDCCD Path categorization at ".concat(t.id,":"),{incoming:e,straight:r.straight,left:r.left,right:r.right}),r}(e,d,a),i=null;switch(n.mode){case"pass_through":i=t.straight;break;case"turn_left":i=t.left;break;case"turn_right":i=t.right}if(i){let e=a.find(e=>e.id===i);if(e)return console.log("\uD83D\uDEA6 Path-based routing at ".concat(l,": ").concat(n.mode," → ").concat(i)),e}if(t.straight){let e=a.find(e=>e.id===t.straight);if(e)return console.warn("⚠️ Intersection ".concat(l,': mode "').concat(n.mode,'" not available, using straight')),e}}}let h=Math.floor(Math.random()*u.length);return console.log("\uD83C\uDFB2 Random path selection at ".concat(l,": ").concat(u[h].id)),u[h]}}},e=>{e.O(0,[831,795,441,255,358],()=>e(e.s=8164)),_N_E=e.O()}]);