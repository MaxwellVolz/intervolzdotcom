(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{444:(e,t,n)=>{Promise.resolve().then(n.bind(n,3184))},3184:(e,t,n)=>{"use strict";n.d(t,{default:()=>b});var o=n(5155),r=n(258),i=n(9336),l=n(6750),s=n(8381),a=n(2115),c=n(6923);function d(e){let{node:t,position:n,visible:r=!0,opacity:i=1}=e,[l,s]=(0,a.useState)(!1);return r?(0,o.jsxs)("group",{position:n,children:[(0,o.jsx)(c.E,{position:[0,0,0],fontSize:.2,color:l?"#60a5fa":"white",anchorX:"center",anchorY:"middle",outlineWidth:.02,outlineColor:"#000000",fillOpacity:i,outlineOpacity:.5*i,onPointerOver:()=>s(!0),onPointerOut:()=>s(!1),children:t.label}),t.description&&l&&(0,o.jsx)(c.E,{position:[0,-.3,0],fontSize:.12,color:"#9ca3af",anchorX:"center",anchorY:"top",maxWidth:2,fillOpacity:i,children:t.description})]}):null}var u=n(1770),p=n(5339);function h(e){let{start:t,end:n,color:r="#3b82f6",opacity:i=.6,animated:l=!1,progress:s=1}=e,c=(0,a.useMemo)(()=>{let e=[new p.Pq0(...t),new p.Pq0(...n)],o=new p.LoY().setFromPoints(e),l=new p.mrM({color:r,transparent:!0,opacity:i,linewidth:2});return new p.N1A(o,l)},[t,n,r,i]);return(0,a.useMemo)(()=>{if(s<1){let e=new p.Pq0(...t),o=new p.Pq0(...n),r=e.lerp(o,s),i=[new p.Pq0(...t),r];c.geometry.setFromPoints(i)}else{let e=[new p.Pq0(...t),new p.Pq0(...n)];c.geometry.setFromPoints(e)}},[t,n,s,c]),(0,u.D)(()=>{let e=c.material;e.color.set(r),e.opacity=l?i*s:i}),(0,o.jsx)("primitive",{object:c})}function g(e){let{level:t,depth:n,visible:r=!0,opacity:i=1,showConnections:l=!0,visibleNodeIds:s}=e,a=t.spacing||2,c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(1===e)return[[0,0]];let n=[],o=t*e/(2*Math.PI);for(let t=0;t<e;t++){let r=t/e*Math.PI*2,i=Math.cos(r)*o,l=Math.sin(r)*o;n.push([i,l])}return n}(t.nodes.length,a),u=t.nodes.map((e,t)=>{var o,r,i,l;let[s,a]=c[t];return[null!=(i=null==(o=e.position)?void 0:o[0])?i:s,null!=(l=null==(r=e.position)?void 0:r[1])?l:a,n]});return(0,o.jsxs)("group",{position:[0,0,0],children:[l&&r&&t.nodes.length>1&&(0,o.jsx)(o.Fragment,{children:t.nodes.slice(0,-1).map((e,t)=>{let n=t+1;return(0,o.jsx)(h,{start:u[t],end:u[n],color:"#3b82f6",opacity:.4*i},"connection-".concat(t,"-").concat(n))})}),(0,o.jsx)("group",{position:[0,0,n],children:t.nodes.map((e,t)=>{var n,l,a,u;let[p,h]=c[t],g=[null!=(a=null==(n=e.position)?void 0:n[0])?a:p,null!=(u=null==(l=e.position)?void 0:l[1])?u:h,0],f=s?s.has(e.id):r;return(0,o.jsx)(d,{node:e,position:g,visible:f,opacity:i},e.id)})})]})}function f(e){let{atlas:t,levelSpacing:n=5,visibleNodes:r,visibleConnections:i,lineProgress:l,currentLevel:s=0}=e,a=t.levels.map((e,t)=>{let o=t*n,r=e.spacing||2,i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(1===e)return[[0,0]];let n=[],o=t*e/(2*Math.PI);for(let t=0;t<e;t++){let r=t/e*Math.PI*2,i=Math.cos(r)*o,l=Math.sin(r)*o;n.push([i,l])}return n}(e.nodes.length,r);return e.nodes.map((e,t)=>{var n,r,l,s;let[a,c]=i[t];return{id:e.id,position:[null!=(l=null==(n=e.position)?void 0:n[0])?l:a,null!=(s=null==(r=e.position)?void 0:r[1])?s:c,o]}})});return(0,o.jsxs)("group",{children:[t.levels.map((e,t)=>{let i=e.nodes.filter(e=>r.has(e.id)).map(e=>e.id),l=Math.abs(t-s),a=1;return 1===l?a=.4:2===l?a=.15:l>=3&&(a=.05),(0,o.jsx)(g,{level:e,depth:t*n,visible:!0,opacity:a,showConnections:!1,visibleNodeIds:new Set(i)},"".concat(e.name,"-").concat(t))}),t.levels.map((e,t)=>{let n=a[t],r=Math.abs(t-s),c=1;return 1===r?c=.4:2===r?c=.15:r>=3&&(c=.05),(e.connections||[]).map((t,r)=>{let s="".concat(e.name,"-").concat(r),a=l.get(s)||0;if(!(i.has(s)||a>0))return null;let d=n.find(e=>e.id===t.from),u=n.find(e=>e.id===t.to);if(!d||!u)return null;let p=[d.position[0],d.position[1],d.position[2]-.1],g=[u.position[0],u.position[1],u.position[2]-.1];return(0,o.jsx)(h,{start:p,end:g,color:t.color||"#3b82f6",opacity:.6*c,animated:a<1,progress:a},s)})}),(t.interLevelConnections||[]).map((e,t)=>{let n,r,c="inter-".concat(t),d=l.get(c)||0;if(!(i.has(c)||d>0))return null;let u=-1,p=-1;for(let t=0;t<a.length;t++){let o=a[t];if(!n&&(n=o.find(t=>t.id===e.from))&&(u=t),!r&&(r=o.find(t=>t.id===e.to))&&(p=t),n&&r)break}if(!n||!r)return null;let g=(Math.abs(u-s)+Math.abs(p-s))/2,f=1;g>=2.5?f=.05:g>=1.5?f=.15:g>=.5&&(f=.4);let m=[n.position[0],n.position[1],n.position[2]-.1],v=[r.position[0],r.position[1],r.position[2]-.1];return(0,o.jsx)(h,{start:m,end:v,color:e.color||"#60a5fa",opacity:.6*f,animated:d<1,progress:d},c)})]})}function m(e){let{state:t,controls:n}=e,{hasStarted:r,isPlaying:i,currentStep:l,totalSteps:s}=t;return console.log("AnimationControlsUI render:",{hasStarted:r,isPlaying:i,currentStep:l,totalSteps:s}),(0,o.jsx)("div",{style:{position:"fixed",bottom:"2rem",left:"50%",transform:"translateX(-50%)",pointerEvents:"none",zIndex:1e3},children:(0,o.jsx)("div",{style:{pointerEvents:"auto",display:"flex",alignItems:"center",gap:"1rem",backgroundColor:"rgba(17, 24, 39, 0.9)",backdropFilter:"blur(8px)",padding:"1rem 1.5rem",borderRadius:"9999px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.5)",border:"1px solid rgba(55, 65, 81, 0.5)"},children:r?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:n.previous,disabled:0===l,style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",cursor:0===l?"not-allowed":"pointer",opacity:0===l?.3:1,borderRadius:"9999px",transition:"background-color 0.2s"},onMouseEnter:e=>{0!==l&&(e.currentTarget.style.backgroundColor="rgba(31, 41, 55, 1)")},onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",title:"Previous",children:(0,o.jsx)("svg",{style:{width:"1.5rem",height:"1.5rem",color:"white"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,o.jsx)("button",{onClick:i?n.pause:n.resume,style:{padding:"0.75rem",backgroundColor:"#2563eb",border:"none",cursor:"pointer",borderRadius:"9999px",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#1d4ed8",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#2563eb",title:i?"Pause":"Play",children:i?(0,o.jsx)("svg",{style:{width:"1.5rem",height:"1.5rem",color:"white"},fill:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):(0,o.jsx)("svg",{style:{width:"1.5rem",height:"1.5rem",color:"white"},fill:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,o.jsx)("button",{onClick:n.next,disabled:l>=s-1,style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",cursor:l>=s-1?"not-allowed":"pointer",opacity:l>=s-1?.3:1,borderRadius:"9999px",transition:"background-color 0.2s"},onMouseEnter:e=>{l<s-1&&(e.currentTarget.style.backgroundColor="rgba(31, 41, 55, 1)")},onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",title:"Next",children:(0,o.jsx)("svg",{style:{width:"1.5rem",height:"1.5rem",color:"white"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,o.jsx)("div",{style:{marginLeft:"1rem",paddingLeft:"1rem",borderLeft:"1px solid rgba(55, 65, 81, 1)"},children:(0,o.jsxs)("div",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:[l+1," / ",s]})}),(0,o.jsx)("button",{onClick:n.reset,style:{padding:"0.5rem",marginLeft:"0.5rem",backgroundColor:"transparent",border:"none",cursor:"pointer",borderRadius:"9999px",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="rgba(31, 41, 55, 1)",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",title:"Reset",children:(0,o.jsx)("svg",{style:{width:"1.25rem",height:"1.25rem",color:"#9ca3af"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}):(0,o.jsx)("button",{onClick:()=>{console.log("Begin Journey clicked"),n.start()},style:{padding:"0.75rem 2rem",backgroundColor:"#2563eb",color:"white",fontSize:"1.125rem",fontWeight:600,borderRadius:"9999px",border:"none",cursor:"pointer"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#1d4ed8",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#2563eb",children:"Begin Journey"})})})}function v(e){let{targetLevel:t,levelSpacing:n=5,animationDuration:o=1}=e,{camera:r}=(0,u.C)(),i=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=new p.Pq0(0,0,5+5*t);.1>r.position.distanceTo(e)||(console.log("Camera animating to level ".concat(t),{from:r.position.toArray(),to:e.toArray()}),i.current={startPosition:r.position.clone(),targetPosition:e,startTime:Date.now(),duration:1e3*o})},[t,r,n,o]),(0,u.D)(()=>{if(!i.current)return;let{startPosition:e,targetPosition:o,startTime:l,duration:s}=i.current,a=Math.min((Date.now()-l)/s,1),c=a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2;r.position.lerpVectors(e,o,c);let d=t*n;r.lookAt(0,0,d),a>=1&&(i.current=null)}),null}function b(){let{atlas:e,loading:t,error:n}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/mundi/data/atlas.json",[t,n]=(0,a.useState)(null),[o,r]=(0,a.useState)(!0),[i,l]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let t=!0;return async function(){try{r(!0),l(null);let o=await fetch(e);if(!o.ok)throw Error("Failed to load atlas: ".concat(o.status," ").concat(o.statusText));let i=await o.json();if(!i.levels||!Array.isArray(i.levels))throw Error("Invalid atlas format: missing or invalid levels array");t&&n(i)}catch(e){t&&l(e instanceof Error?e:Error("Unknown error loading atlas"))}finally{t&&r(!1)}}(),()=>{t=!1}},[e]),{atlas:t,loading:o,error:i}}(),{state:c,controls:d}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,[n,o]=(0,a.useState)({currentStep:0,totalSteps:0,isPlaying:!1,hasStarted:!1,speed:t});(0,a.useEffect)(()=>{if(e){let t,n=(t=0,e.levels.forEach(e=>{t+=(e.connections||[]).length}),2+2*(t+=(e.interLevelConnections||[]).length));console.log("Total animation steps: ".concat(n)),o(e=>({...e,totalSteps:n}))}},[e]),(0,a.useEffect)(()=>{if(!n.isPlaying)return;console.log("Auto-advancing from step ".concat(n.currentStep," to ").concat(n.currentStep+1));let e=setTimeout(()=>{o(e=>e.currentStep>=e.totalSteps-1?(console.log("Animation complete"),{...e,isPlaying:!1}):{...e,currentStep:e.currentStep+1})},n.speed);return()=>clearTimeout(e)},[n.isPlaying,n.currentStep,n.speed,n.totalSteps]);let r=(0,a.useCallback)(()=>{console.log("Animation started"),o(e=>({...e,currentStep:0,isPlaying:!0,hasStarted:!0}))},[]),i=(0,a.useCallback)(()=>{o(e=>({...e,isPlaying:!1}))},[]),l=(0,a.useCallback)(()=>{o(e=>({...e,isPlaying:!0}))},[]),s=(0,a.useCallback)(()=>{o(e=>({...e,currentStep:Math.min(e.currentStep+1,e.totalSteps-1),hasStarted:!0}))},[]),c=(0,a.useCallback)(()=>{o(e=>({...e,currentStep:Math.max(e.currentStep-1,0)}))},[]),d=(0,a.useCallback)(()=>{o(e=>({...e,currentStep:0,isPlaying:!1,hasStarted:!1}))},[]);return{state:n,controls:{start:r,pause:i,resume:l,next:s,previous:c,reset:d,goToStep:(0,a.useCallback)(e=>{o(t=>({...t,currentStep:Math.max(0,Math.min(e,t.totalSteps-1)),hasStarted:!0}))},[])}}}(e,1500),u=(0,a.useMemo)(()=>{if(!e)return{visibleNodes:new Set,visibleConnections:new Set,lineProgress:new Map};let t=function(e,t){let n=new Set,o=new Set,r=new Map;if(t<=0)return{visibleNodes:n,visibleConnections:o,lineProgress:r};let i=1;if(e.levels.length>0&&e.levels[0].nodes.length>0&&(n.add(e.levels[0].nodes[0].id),i++),t<i)return{visibleNodes:n,visibleConnections:o,lineProgress:r};let l=[];for(let t=0;t<e.levels.length;t++){let n=e.levels[t],o=n.connections||[];for(let e=0;e<o.length;e++){let r=o[e];l.push({key:"".concat(n.name,"-").concat(e),from:r.from,to:r.to,levelIndex:t})}let r=e.interLevelConnections||[];for(let e=0;e<r.length;e++){let o=r[e];if(n.nodes.some(e=>e.id===o.from)){let n="inter-".concat(e);l.push({key:n,from:o.from,to:o.to,levelIndex:t})}}}for(let e of l){if(n.add(e.from),t>=i)o.add(e.key),r.set(e.key,1),i++;else break;if(t>=i)n.add(e.to),i++;else break}return{visibleNodes:n,visibleConnections:o,lineProgress:r}}(e,c.currentStep);return console.log("Step ".concat(c.currentStep,":"),{visibleNodes:Array.from(t.visibleNodes),visibleConnections:Array.from(t.visibleConnections),lineProgress:Array.from(t.lineProgress.entries())}),t},[e,c.currentStep]),p=(0,a.useMemo)(()=>e?function(e,t){if(t<=1)return 0;let n=2,o=0,r=[];for(let t=0;t<e.levels.length;t++){let n=e.levels[t],o=n.connections||[];for(let e=0;e<o.length;e++)r.push({levelIndex:t,isInterLevel:!1});let i=e.interLevelConnections||[];for(let o=0;o<i.length;o++){let l=i[o];if(n.nodes.some(e=>e.id===l.from)){let n=e.levels.length-1;for(let t=0;t<e.levels.length;t++)if(e.levels[t].nodes.some(e=>e.id===l.to)){n=t;break}r.push({levelIndex:t,isInterLevel:!0,targetLevel:n})}}}for(let e of r){if(e.isInterLevel&&void 0!==e.targetLevel){if(t===n)return e.targetLevel;t>n&&(o=e.targetLevel)}if(t<(n+=2))break;e.isInterLevel||(o=e.levelIndex)}return o}(e,c.currentStep):0,[e,c.currentStep]);return((0,a.useEffect)(()=>{e&&(console.log("Atlas loaded:",e),console.log("Levels: ".concat(e.levels.length)),e.levels.forEach((e,t)=>{console.log("  Level ".concat(t,": ").concat(e.name," (").concat(e.nodes.length," nodes)"))}))},[e]),t)?(0,o.jsx)("div",{id:"canvas-container",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,o.jsx)("p",{style:{color:"white"},children:"Loading atlas..."})}):n?(0,o.jsx)("div",{id:"canvas-container",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,o.jsxs)("p",{style:{color:"red"},children:["Error loading atlas: ",n.message]})}):e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{id:"canvas-container",children:(0,o.jsxs)(r.Hl,{children:[(0,o.jsx)(i.u,{makeDefault:!0,position:[0,0,5],fov:75}),(0,o.jsx)(l.N,{enableDamping:!0,dampingFactor:.05,minDistance:2,maxDistance:50}),(0,o.jsx)(v,{targetLevel:p,levelSpacing:5,animationDuration:1.5}),(0,o.jsx)("ambientLight",{intensity:.2,color:"#1e3a8a"}),(0,o.jsx)("directionalLight",{position:[10,10,5],intensity:.4,color:"#60a5fa"}),(0,o.jsx)("directionalLight",{position:[-10,-10,-5],intensity:.3,color:"#3b82f6"}),(0,o.jsx)("pointLight",{position:[0,0,0],intensity:1,color:"#60a5fa",distance:25,decay:2}),(0,o.jsx)("pointLight",{position:[0,5,10],intensity:.6,color:"#93c5fd",distance:15,decay:2}),(0,o.jsx)("spotLight",{position:[0,10,5],angle:.6,penumbra:1,intensity:.8,color:"#60a5fa",castShadow:!1}),(0,o.jsx)("fog",{attach:"fog",args:["#000510",8,35]}),(0,o.jsx)(f,{atlas:e,levelSpacing:5,visibleNodes:u.visibleNodes,visibleConnections:u.visibleConnections,lineProgress:u.lineProgress,currentLevel:p}),(0,o.jsxs)(s.s0,{children:[(0,o.jsx)(s.fE,{offset:.3,darkness:.9,eskil:!1}),(0,o.jsx)(s.mK,{intensity:.5,luminanceThreshold:.2,luminanceSmoothing:.9,height:300})]})]})}),(0,o.jsx)(m,{state:c,controls:d})]}):(0,o.jsx)("div",{id:"canvas-container",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,o.jsx)("p",{style:{color:"white"},children:"No atlas data available"})})}}},e=>{e.O(0,[367,831,664,794,683,413,980,441,255,358],()=>e(e.s=444)),_N_E=e.O()}]);